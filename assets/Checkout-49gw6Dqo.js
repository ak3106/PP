import{u as M,i as R,r as i,j as e,H as I,d as L}from"./index-DOtjrhYQ.js";import{B as g}from"./Button-CPsMlY80.js";import{I as m}from"./Input-DZU73Jci.js";import{L as F}from"./log-in-BH5jP7aJ.js";import{S as f,A as $,C as B}from"./shopping-bag-DcDHfVCq.js";import{C as T}from"./circle-check-big-Dt1H1cxA.js";import{T as G}from"./triangle-alert-DVFMwAjd.js";import{D as H}from"./dollar-sign-DK601OrL.js";import{T as A}from"./truck-D9_MPKsv.js";const ee=({user:r})=>{const u=M(),{cart:n,dispatchCart:O}=R();i.useEffect(()=>{r===null&&(localStorage.setItem("redirect_after_login","/checkout"),u("/login"))},[r,u]);const[a,N]=i.useState({name:r?.name||"",email:r?.email||"",phone:"",address:"",city:"",pincode:""}),[t,v]=i.useState("cod"),[p,w]=i.useState(!1),[S,q]=i.useState(null),[o,C]=i.useState({});i.useEffect(()=>{r&&N(s=>({...s,name:r.name||s.name,email:r.email||s.email}))},[r]);const b=i.useMemo(()=>n.reduce((s,c)=>s+c.price*c.quantity,0),[n]),P=b*.05,y=i.useMemo(()=>n.length===0||t==="store"?0:100,[n,t]),k=b+P+y,x=s=>`â‚¹${Math.round(s).toLocaleString("en-IN")}`,h=s=>{const{name:c,value:_}=s.target;N(j=>({...j,[c]:_})),C(j=>({...j,[c]:void 0}))},E=()=>{const s={};return a.name.trim()||(s.name="Full Name is required."),a.phone.match(/^\d{10}$/)||(s.phone="Valid 10-digit Phone is required."),t!=="store"&&(a.address.trim()||(s.address="Address is required."),a.city.trim()||(s.city="City is required."),a.pincode.match(/^\d{6}$/)||(s.pincode="Valid 6-digit Pincode is required.")),C(s),Object.keys(s).length===0},D=s=>{if(s.preventDefault(),!E()){window.scrollTo(0,0);return}w(!0);const c={name:a.name,email:a.email,phone:a.phone,address:a.address,city:a.city,pincode:a.pincode};localStorage.setItem("pragya_shipping_details",JSON.stringify(c)),setTimeout(()=>{w(!1),q("success"),O({type:"CLEAR_CART"}),localStorage.removeItem("redirect_after_login")},2e3)};if(r===null)return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-20 text-center min-h-[70vh]",children:[e.jsx(F,{className:"w-16 h-16 text-indigo-500 mx-auto mb-4 animate-bounce"}),e.jsx("h1",{className:"text-3xl font-bold text-indigo-700 mb-4",children:"Securing your Checkout..."}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Redirecting to login to verify your identity before purchase."})]});if(n.length===0&&!S)return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-20 text-center min-h-[70vh]",children:[e.jsx(f,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold text-red-600 mb-4",children:"Cart is Empty"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Please add items to your cart before checking out."}),e.jsxs(g,{onClick:()=>u("/products"),className:"flex items-center mx-auto",children:[e.jsx($,{className:"w-4 h-4 mr-2"})," Go to Shop"]})]});if(S==="success")return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-20 text-center min-h-[70vh] bg-green-50 rounded-3xl shadow-2xl",children:[e.jsx(T,{className:"w-20 h-20 text-green-600 mx-auto mb-6 animate-pulse"}),e.jsx("h1",{className:"text-4xl font-extrabold text-green-800 mb-3",children:"Order Placed Successfully!"}),e.jsxs("p",{className:"text-xl text-gray-700 mb-6",children:["Thank you, ",a.name.split(" ")[0],"! Your order has been received."]}),e.jsx("p",{className:"text-gray-600 mb-8",children:"We'll notify you once processing is complete."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs(g,{onClick:()=>u("/products"),variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-100",children:[e.jsx(f,{className:"w-5 h-5 mr-2"})," Shop More"]}),e.jsxs(g,{onClick:()=>u("/"),variant:"primary",children:[e.jsx(I,{className:"w-5 h-5 mr-2"})," Go to Home"]})]})]});const l=t==="store",d=!l;return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10",children:[e.jsx("h1",{className:"text-4xl font-extrabold text-gray-900 mb-8 border-b pb-2",children:"Secure Checkout"}),Object.keys(o).length>0&&e.jsxs("div",{className:"p-4 mb-6 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg flex items-center shadow-md",children:[e.jsx(G,{className:"w-6 h-6 mr-3 flex-shrink-0"}),e.jsxs("p",{className:"font-semibold",children:["Please correct the ",Object.keys(o).length," errors below before placing your order."]})]}),e.jsxs("form",{onSubmit:D,className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-xl border border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-bold text-indigo-700 mb-6 flex items-center",children:[e.jsx(H,{className:"w-6 h-6 mr-3"})," 1. Payment Method"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:`flex items-center p-4 rounded-xl cursor-pointer transition-all duration-200 border-2 ${t==="cod"?"bg-indigo-50 border-indigo-600":"bg-gray-50 border-gray-200 hover:bg-gray-100"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"cod",checked:t==="cod",onChange:()=>v("cod"),className:"h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-500"}),e.jsxs("div",{className:"ml-4 flex items-center justify-between w-full",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Cash on Delivery (COD)"}),e.jsx(A,{className:"w-6 h-6 text-blue-600"})]})]}),e.jsxs("label",{className:`flex items-center p-4 rounded-xl cursor-pointer transition-all duration-200 border-2 ${t==="store"?"bg-indigo-50 border-indigo-600":"bg-gray-50 border-gray-200 hover:bg-gray-100"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"store",checked:t==="store",onChange:()=>v("store"),className:"h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-500"}),e.jsxs("div",{className:"ml-4 flex items-center justify-between w-full",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Pay at Store (Local Pickup)"}),e.jsx(L,{className:"w-6 h-6 text-red-600"})]}),l&&e.jsx("span",{className:"ml-4 text-sm text-green-600 font-bold",children:"+ FREE Shipping"})]}),e.jsxs("div",{className:"flex items-center p-4 rounded-xl border-2 border-dashed bg-gray-100 opacity-60 cursor-not-allowed",children:[e.jsx("input",{type:"radio",disabled:!0,className:"h-5 w-5 border-gray-300"}),e.jsxs("div",{className:"ml-4 flex items-center justify-between w-full",children:[e.jsx("span",{className:"font-semibold text-gray-500",children:"Online Payment (Coming Soon)"}),e.jsx(B,{className:"w-6 h-6 text-gray-400"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-xl border border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-bold text-indigo-700 mb-6 flex items-center",children:[e.jsx(A,{className:"w-6 h-6 mr-3"})," 2. Delivery Information ",d&&e.jsx("span",{className:"text-sm text-red-500 ml-2",children:"(Required)"})]}),l&&e.jsxs("div",{className:"p-4 mb-4 bg-yellow-100 rounded-xl text-yellow-800",children:[e.jsx("p",{className:"font-semibold",children:"Local Pickup Selected:"}),e.jsx("p",{className:"text-sm",children:"Please confirm your name and contact details below for notification when your order is ready at the store (Madhya Pradesh)."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m,{label:"Full Name",name:"name",value:a.name,onChange:h,required:!0,error:o.name}),e.jsx(m,{label:"Email Address",name:"email",type:"email",value:a.email,onChange:r?void 0:h,required:!0,disabled:!!r,className:"bg-gray-100 cursor-not-allowed"}),e.jsx(m,{label:"Phone Number",name:"phone",type:"tel",value:a.phone,onChange:h,required:!0,error:o.phone}),e.jsx(m,{label:"Pincode",name:"pincode",value:a.pincode,onChange:d?h:void 0,required:d,disabled:l,error:o.pincode,className:l?"bg-gray-100":""}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(m,{label:"Street Address / Locality",name:"address",value:a.address,onChange:d?h:void 0,required:d,disabled:l,error:o.address,className:l?"bg-gray-100":""})}),e.jsx(m,{label:"City / Town",name:"city",value:a.city,onChange:d?h:void 0,required:d,disabled:l,error:o.city,className:l?"bg-gray-100":""}),e.jsx(m,{label:"State",value:"Madhya Pradesh",disabled:!0,className:"bg-gray-100 cursor-not-allowed"})]})]})]}),e.jsx("div",{className:"lg:col-span-1 sticky top-24 h-fit",children:e.jsxs("div",{className:"bg-indigo-50 p-6 rounded-3xl shadow-2xl border border-indigo-100",children:[e.jsxs("h2",{className:"text-2xl font-bold text-indigo-800 mb-4 border-b border-indigo-200 pb-3 flex items-center",children:[e.jsx(f,{className:"w-5 h-5 mr-2"})," Order Summary"]}),e.jsx("div",{className:"border-b border-indigo-200 pb-4 mb-4 space-y-2 max-h-48 overflow-y-auto",children:n.map(s=>e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsxs("span",{className:"truncate pr-2",children:[s.quantity,"x ",s.product.name," (",s.selectedSize,")"]}),e.jsx("span",{children:x(s.price*s.quantity)})]},s.itemId))}),e.jsxs("div",{className:"space-y-3 text-gray-700 text-md mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-semibold",children:x(b)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping Fee"}),e.jsx("span",{className:"font-semibold",children:y===0?"FREE":x(y)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxes (5%)"}),e.jsx("span",{className:"font-semibold",children:x(P)})]}),e.jsxs("div",{className:"flex justify-between pt-3 border-t border-indigo-200 text-xl font-extrabold text-indigo-900",children:[e.jsx("span",{children:"Total Payable"}),e.jsx("span",{children:x(k)})]})]}),e.jsxs(g,{type:"submit",className:"w-full py-3 text-lg mt-4 flex items-center justify-center",disabled:p||n.length===0,children:[p?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}):e.jsx(T,{className:"w-5 h-5 mr-2"}),p?"Processing...":`Place Order (${x(k)})`]}),e.jsxs("p",{className:"mt-3 text-xs text-center text-gray-600",children:["You are paying via ",t==="cod"?"Cash on Delivery":"Pay at Store","."]})]})})]})]})};export{ee as default};
